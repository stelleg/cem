Y = \g.(\x.[g x x] \x.[g x x])
then = \cont.\result.cont
Pair = \f.\s.\p.(p f s)
Cons = \h.\t.\n.\c.(c h t)
Nil = \n.\c.n
write = \fd.\buf.\count.[fd buf count 1 !3]
mmap = \addr.\len.\prot.\flags.\fd.\offset.[addr len prot flags fd offset 9 !6]
exit = \code.[code 60 !1]
munmap = \addr.\len.[addr len 11 !2] 
pageSize = 4096
malloc = \len.(mmap 0 len 255 34 [0 1 -] 0)
free = \ptr.(munmap ptr 1)
newPage = \w.(malloc pageSize \ptr.([ptr 0 <=] (exit 1) ptr))
putStrBuf = \size.\buf.(Y \putStrBuf.\loc.\s.{finished = (Pair loc s)} (s
  finished 
  \h.\t.([[loc buf -] size >=]
    finished 
    ([h loc @b] (putStrBuf [loc 1 +] t)))) buf) 
writeFd = \fd.{iobuf = (newPage 0)} (Y \writeFd.\str.[
  (putStrBuf pageSize iobuf str) \p.\s.
  (write fd iobuf [p iobuf -] \n.[
  (s n \h.\t.(writeFd s)) then
  (free iobuf) then n])
])
print = (writeFd 1)

main = (print "Hello world\n")
